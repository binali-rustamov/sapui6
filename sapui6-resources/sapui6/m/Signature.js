jQuery.sap.declare("sapui6.m.Signature"),jQuery.sap.require("sap.ui.core.Control"),sap.ui.core.Control.extend("sapui6.m.Signature",{metadata:{library:"sapui6.m",properties:{visible:{type:"boolean",defaultValue:!0},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"400px"},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100px"},backgroundColor:{type:"string",defaultValue:"#fff"},borderStyle:{type:"string",defaultValue:"1px solid #000"},strokeColor:{type:"string",defaultValue:"#000"},lineWidth:{type:"int",defaultValue:2},dataURL:{type:"string",defaultValue:null}}},_canvas:null,_ctx:null,_prevPosition:null,_start:null,_end:null,renderer:function(t,e){e.getVisible()&&(t.write("<div"),t.writeControlData(e),t.addStyle("width",e.getWidth()),t.addStyle("height",e.getHeight()),t.addStyle("border",e.getBorderStyle()),t.addStyle("background-color",e.getBackgroundColor()),t.writeStyles(),t.write(">"),t.write("<canvas"),t.writeAttribute("id",e.getId()+"-canvas"),t.writeAttribute("width",e.getWidth()),t.writeAttribute("height",e.getHeight()),e.getDataURL()&&(t.addStyle("display","none"),t.writeStyles()),t.write("></canvas>"),t.write("<img"),e.getDataURL()?t.writeAttribute("src",e.getDataURL()):(t.addStyle("display","none"),t.writeStyles()),t.writeAttribute("id",e.getId()+"-canvas-img"),t.write(">"),t.write("</div>"))},onAfterRendering:function(){this._canvas=document.getElementById(this.getId()+"-canvas"),this._prevPosition=new Array,this._canvas.getContext&&(this._ctx=this._canvas.getContext("2d"),this._ctx.lineWidth=this.getLineWidth(),this._ctx.strokeStyle=this.getStrokeColor(),this._canvas.onmousedown=this._startDraw.bind(this),this._canvas.onmouseup=this._stopDraw.bind(this),this._canvas.ontouchstart=this._startDraw.bind(this),this._canvas.ontouchend=this._stopDraw.bind(this),this._canvas.ontouchmove=this._draw.bind(this))}}),sapui6.m.Signature.prototype._startDraw=function(t){if(t.touches){for(var e=1;e<=t.touches.length;e++)this._prevPosition[e]=this._getCoords(t.touches[e-1]);this._start=this._getCoords(t.touches[0])}else this._prevPosition[0]=this._getCoords(t),this._canvas.onmousemove=this._draw.bind(this),this._start=this._getCoords(t);return!1},sapui6.m.Signature.prototype._stopDraw=function(t){this._end=t.touches?this._prevPosition[1]:this._getCoords(t),this._start.x==this._end.x&&this._start.y==this._end.y&&(this._ctx.arc(this._end.x,this._end.y,this.getLineWidth(),0,2*Math.PI,!1),this._ctx.fillStyle=this.getStrokeColor(),this._ctx.fill()),this._ctx.closePath(),t.preventDefault(),this._canvas.onmousemove=null,this.setProperty("dataURL",this._canvas.toDataURL(),!0)},sapui6.m.Signature.prototype._draw=function(t){if(this._ctx.beginPath(),t.touches)for(var e=1;e<=t.touches.length;e++){var i=this._getCoords(t.touches[e-1]);this._prevPosition[e]=this._drawLine(this._prevPosition[e].x,this._prevPosition[e].y,i.x,i.y)}else{var i=this._getCoords(t);this._prevPosition[0]=this._drawLine(this._prevPosition[0].x,this._prevPosition[0].y,i.x,i.y)}return this._ctx.stroke(),!1},sapui6.m.Signature.prototype._drawLine=function(t,e,i,s){return this._ctx.moveTo(t,e),this._ctx.lineTo(i,s),{x:i,y:s}},sapui6.m.Signature.prototype._getCoords=function(t){return t.offsetX?{x:t.offsetX,y:t.offsetY}:{x:t.pageX-this._canvas.offsetLeft,y:t.pageY-this._canvas.offsetTop}},sapui6.m.Signature.prototype.clear=function(){this.setProperty("dataURL",null,!0),this.invalidate()};
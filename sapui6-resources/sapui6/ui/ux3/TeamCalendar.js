jQuery.sap.declare("sapui6.ui.ux3.TeamCalendar"),jQuery.sap.require("sap.ui.core.Control"),sap.ui.core.Control.extend("sapui6.ui.ux3.TeamCalendar",{metadata:{library:"sapui6.ui.ux3",properties:{width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},bodyHeight:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},memberWidth:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"200px"},groupWidth:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"200px"},itemWidth:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"50px"},itemHeight:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"48px"},marginLeft:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},marginRight:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},marginTop:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},marginBottom:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},yyyymm:{type:"string",defaultValue:null},memberTitle:{type:"string",defaultValue:""},groupTitle:{type:"string",defaultValue:""},weekLabel:{type:"string",defaultValue:"Sun,Mon,Tue,Wed,Thu,Fri,Sat"},monthLabel:{type:"string",defaultValue:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec"},dateFormat:{type:"string",defaultValue:"dd.MM.yyyy"},group:{type:"boolean",defaultValue:!1},visible:{type:"boolean",defaultValue:!0}},defaultAggregation:"item",aggregations:{items:{type:"sapui6.ui.ux3.TeamCalendarItem",multiple:!0,singularName:"item",bindable:"bindable"},category:{type:"sapui6.ui.ux3.TeamCalendarCategory",multiple:!0,singularName:"category",bindable:"bindable"},holiday:{type:"sapui6.ui.ux3.TeamCalendarHoliday",multiple:!0,singularName:"holiday",bindable:"bindable"}},events:{previous:{},next:{},selectMember:{},selectGroup:{},selectDay:{}}},_itemWidth:40,_itemHeight:38,_memberCnt:0,_end_of_month:30,_groupSize:{},_holiday:null,onBeforeRendering:function(){jQuery.sap.require("sap.ui.core.theming.Parameters")},renderer:function(e,t){if(t.getVisible()){if(!t.getYyyymm()){var i=new Date;t.setYyyymm(String(i.getFullYear())+String(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1))}t._holiday=null,t._itemWidth=parseInt(t.getItemWidth().split("px")[0]),t._itemHeight=parseInt(t.getItemHeight().split("px")[0]),e.write("<div"),e.writeControlData(t),e.addStyle("width",t.getWidth()),t.getMarginLeft()&&e.addStyle("margin-left",t.getMarginLeft()),t.getMarginRight()&&e.addStyle("margin-right",t.getMarginRight()),t.getMarginTop()&&e.addStyle("margin-top",t.getMarginTop()),t.getMarginBottom()&&e.addStyle("margin-bottom",t.getMarginBottom()),e.writeStyles(),e.addClass("sapui6-Calendar"),e.writeClasses(),e.write(">"),t.renderHeader(e,t),t.renderBody(e,t),t.renderLegend(e,t),e.write("</div>")}},onAfterRendering:function(){var e=this,t=this.getItems();if(t&&t.length>0){for(var i={},a=t.length,r=0;a>r;r++)if(t[r].getDate().substring(0,6)==this.getYyyymm()){var l=t[r].getKey()+"-"+parseInt(t[r].getDate().substring(6));if(void 0==i[l]){var d=[];d.push(t[r]),i[l]=d}else i[l].push(t[r])}for(key in i)$("#"+this.getId()+"-"+key).html(this.renderTaskSVG(i[key]))}jQuery.sap.delayedCall(50,e,function(){e._handleResize()}),$(window).resize(function(){jQuery.sap.delayedCall(50,e,function(){e._handleResize()})})}}),sapui6.ui.ux3.TeamCalendar.M_EVENTS={previous:"previous",next:"next",selectMember:"selectMember",selectGroup:"selectGroup",selectDay:"selectDay"},sapui6.ui.ux3.TeamCalendar.prototype.renderHeader=function(e,t){var i=t.getMonthLabel().split(",");12!=i.length&&(i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]);var a=t.getYyyymm().substring(0,4),r=parseInt(t.getYyyymm().substring(4)),l=r-1;10>l&&(l=String("0"+l));var d=r+1;10>d?d=String("0"+d):d>12&&(d="01",a+=1),e.write("<div"),e.addClass("sapui6-CalHead"),e.writeClasses(),e.writeAttribute("id",t.getId()+"-head"),e.write(">");var s=new sap.ui.commons.Button({icon:"sap-icon://media-reverse",press:function(){t.firePrevious({yyyymm:a+l})}});e.renderControl(s),e.write("<span"),e.addClass("sapui6-CalDate"),e.writeClasses(),e.addStyle("padding-left","20px"),e.addStyle("padding-right","20px"),e.addStyle("padding-top","5px"),e.writeStyles(),e.write(">"),e.write(i[r-1]+" "+a),e.write("</span>");var u=new sap.ui.commons.Button({icon:"sap-icon://media-play",press:function(){t.fireNext({yyyymm:a+d})}});e.renderControl(u),e.write("</div>")},sapui6.ui.ux3.TeamCalendar.prototype.renderBody=function(e,t){var i=[31,28,31,30,31,30,31,31,30,31,30,31],a=t.getWeekLabel().split(",");7!=a.length&&(a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var r=(new Array,t.getYyyymm().substring(0,4)),l=t.getYyyymm().substring(4);(r%4==0&&r%100!=0||r%400==0)&&(i[1]=29);var d=i[parseInt(l)-1];t._end_of_month=d;var s=new Date(r+"-"+l+"-01").getDay(),u=parseInt(t.getMemberWidth().split("px")[0]);t.getGroup()&&(u+=parseInt(t.getGroupWidth().split("px")[0])),u=String(u)+"px",e.write("<div>"),e.write("	<div"),e.writeAttribute("id",t.getId()+"-left"),e.addStyle("float","left"),e.addStyle("width",u),e.writeStyles(),e.write(">"),e.write("<div"),e.writeAttribute("id",t.getId()+"-head-left"),e.write(">"),t.getGroup()&&(e.write("<div"),e.addClass("sapui6-CalMemberH"),e.writeClasses(),e.write(">"),e.write("<div"),e.addClass("sapui6-CalTeam"),e.writeClasses(),e.addStyle("width",t.getGroupWidth()),e.addStyle("height",2*t._itemHeight+"px"),e.addStyle("line-height",2*t._itemHeight-2+"px"),e.writeStyles(),e.write(">"),e.write("<span"),e.addClass("sapui6-CalMemberName"),e.writeClasses(),e.write(">"),e.write(t.getGroupTitle()),e.write("</span>"),e.write("</div>"),e.write("</div>")),e.write("<div"),e.addClass("sapui6-CalMemberH"),e.writeClasses(),e.write(">"),e.write("<div"),e.addClass("sapui6-CalTeam"),e.writeClasses(),e.addStyle("width",t.getMemberWidth()),e.addStyle("height",2*t._itemHeight+"px"),e.addStyle("line-height",2*t._itemHeight-2+"px"),e.writeStyles(),e.write(">"),e.write("<span"),e.addClass("sapui6-CalMemberName"),e.writeClasses(),e.write(">"),e.write(t.getMemberTitle()),e.write("</span>"),e.write("</div>"),e.write("</div>"),e.write("</div>"),e.write("<div"),e.writeAttribute("id",t.getId()+"-body-left"),e.addStyle("float","left"),e.addStyle("width",u),t.getBodyHeight()&&(e.addStyle("height",t.getBodyHeight()),e.addStyle("overflow-x","hidden"),e.addStyle("overflow-y","hidden")),e.writeStyles(),e.write(">");var o={};t._memberCnt=0;var n="";t.getGroup()&&t._calculateGroupSize();var g=t.getItems();if(g&&g.length>0)for(var p=g.length,y=0;p>y;y++)void 0==o[g[y].getKey()]&&(t.getGroup()&&n!=g[y].getGroupKey()&&(e.write("<div"),e.addClass("sapui6-CalMemberH"),e.writeClasses(),e.write(">"),e.write("<div"),e.addClass("sapui6-CalMember"),e.writeClasses(),e.addStyle("width",t.getGroupWidth()),e.addStyle("height",t._itemHeight*t._groupSize[g[y].getGroupKey()]+"px"),e.addStyle("line-height",t._itemHeight*t._groupSize[g[y].getGroupKey()]-2+"px"),e.writeStyles(),e.write(">"),e.write("<span"),e.addClass("sapui6-CalMemberName"),e.writeClasses(),e.write(" onclick=\"javascript:sap.ui.getCore().byId('"+t.getId()+"').fireSelectGroup({groupKey:'"+g[y].getGroupKey()+"'});\""),e.write(">"),e.write(g[y].getGroupTitle()),e.write("</span>"),e.write("</div>"),e.write("</div>"),n=g[y].getGroupKey()),e.write("<div"),e.addClass("sapui6-CalMemberH"),e.writeClasses(),e.write(">"),e.write("<div"),e.addClass("sapui6-CalMember"),e.writeClasses(),e.addStyle("width",t.getMemberWidth()),e.addStyle("height",t._itemHeight+"px"),e.addStyle("line-height",t._itemHeight-2+"px"),e.writeStyles(),e.write(">"),e.write("<span"),e.addClass("sapui6-CalMemberName"),e.writeClasses(),e.write(" onclick=\"javascript:sap.ui.getCore().byId('"+t.getId()+"').fireSelectMember({key:'"+g[y].getKey()+"'});\""),e.write(">"),e.write(g[y].getTitle()),e.write("</span>"),e.write("</div>"),e.write("</div>"),o[g[y].getKey()]=!0,t._memberCnt++);e.write("</div>"),e.write("</div>"),e.write("<div"),e.writeAttribute("id",t.getId()+"-right"),e.addStyle("float","left"),e.writeStyles(),e.write(">"),e.write("<div"),e.writeAttribute("id",t.getId()+"-header-right"),e.addStyle("overflow-x","hidden"),e.addStyle("overflow-y","hidden"),e.writeStyles(),e.write(">"),e.write("<div"),e.addClass("sapui6-CalDays"),e.writeClasses(),e.addStyle("width",t._itemWidth*d+"px"),e.writeStyles(),e.write(">");for(var h=s,y=0;d>y;y++){e.write("<div"),e.addClass("sapui6-CalDay"),e.writeClasses(),e.addStyle("width",t._itemWidth+"px"),e.addStyle("height",t._itemHeight+"px"),e.addStyle("line-height",t._itemHeight-2+"px");var w=t.getYyyymm()+(9>y?"0":"")+String(y+1),m=t._getHoliday(w);m&&e.addStyle("background-color",m.getColor()),e.writeStyles(),e.write(">"),e.write("<span"),e.addClass("sapui6-CalDayNum"),(0==h||6==h)&&e.addClass("sapui6-CalDayWeekEnd"),e.writeClasses(),e.write(">"),e.write(a[h]),6==h?h=0:h++,e.write("</span>"),e.write("</div>")}e.write("</div>"),e.write("<div"),e.addClass("sapui6-CalDays"),e.writeClasses(),e.addStyle("width",t._itemWidth*d+"px"),e.writeStyles(),e.write(">"),h=s;for(var y=0;d>y;y++){e.write("<div"),e.addClass("sapui6-CalDay"),e.writeClasses(),e.addStyle("width",t._itemWidth+"px"),e.addStyle("height",t._itemHeight+"px"),e.addStyle("line-height",t._itemHeight-2+"px");var w=t.getYyyymm()+(9>y?"0":"")+String(y+1),m=t._getHoliday(w);m&&e.addStyle("background-color",m.getColor()),e.writeStyles(),e.write(">"),e.write("<span"),e.addClass("sapui6-CalDayNum"),(0==h||6==h)&&e.addClass("sapui6-CalDayWeekEnd"),6==h?h=0:h++,e.writeClasses(),e.write(">"),e.write(y+1),e.write("</span>"),e.write("</div>")}if(e.write("</div>"),e.write("</div>"),e.write("<div"),e.addStyle("overflow-x","auto"),e.addStyle("overflow-y","auto"),t.getBodyHeight()&&e.addStyle("height",t.getBodyHeight()),e.writeStyles(),e.writeAttribute("id",t.getId()+"-body-right"),e.writeAttribute("onscroll","javascript:sap.ui.getCore().byId('"+t.getId()+"').doScroll();"),e.write(">"),o={},g&&g.length>0)for(var p=g.length,y=0;p>y;y++)if(void 0==o[g[y].getKey()]){e.write("<div"),e.addClass("sapui6-CalDays"),e.writeClasses(),e.addStyle("width",t._itemWidth*d+"px"),e.writeStyles(),e.write(">");for(var h=s,C=0;d>C;C++){e.write("<div"),e.addClass("sapui6-CalDay"),e.writeClasses(),e.addStyle("width",t._itemWidth+"px"),e.addStyle("height",t._itemHeight+"px"),e.addStyle("line-height",t._itemHeight-2+"px");var w=t.getYyyymm()+(9>C?"0":"")+String(C+1),m=t._getHoliday(w);m&&e.addStyle("background-color",m.getColor()),e.writeStyles(),e.write(">"),e.write("<span"),e.writeAttribute("id",t.getId()+"-"+g[y].getKey()+"-"+(C+1));var S=9>C?"0"+(C+1):String(C+1);e.write(" onclick=\"javascript:sap.ui.getCore().byId('"+t.getId()+"').fireSelectDay({key:'"+g[y].getKey()+"', yyyymmdd:'"+(t.getYyyymm()+S)+"'});\""),e.addClass("sapui6-CalDayNum"),(0==h||6==h)&&e.addClass("sapui6-CalDayWeekEnd"),6==h?h=0:h++,e.writeClasses(),e.write(">"),e.write("</span>"),e.write("</div>")}e.write("</div>"),o[g[y].getKey()]=!0}e.write("</div>"),e.write("</div>"),e.write("</div>"),e.write("</div>")},sapui6.ui.ux3.TeamCalendar.prototype.renderLegend=function(e,t){var i=t.getCategory();if(i&&i.length>0){e.write("<div"),e.addStyle("text-align","center"),e.addStyle("padding","10px"),e.writeStyles(),e.addClass("sapui6-Legend"),e.writeClasses(),e.write(">");for(var a=i.length,r=0;a>r;r++){var l=i[r].getColor(),d=i[r].getTitle();e.write("<span"),e.addStyle("padding-right","30px"),e.writeStyles(),e.write(">"),e.renderControl(new sap.ui.core.Icon({src:"sap-icon://color-fill",color:l})),e.write(" "+d),e.write("</span>")}var s=t.getHoliday();a=s.length;for(var r=0;a>r;r++){var l=s[r].getColor(),d=s[r].getTitle(),u=s[r].getDate();e.write("<span"),e.addStyle("padding-right","30px"),e.addStyle("white-space","nowrap"),e.writeStyles(),e.write(">"),e.renderControl(new sap.ui.core.Icon({src:"sap-icon://color-fill",color:l})),e.write(" "+d),e.write(" ("+t._convertDateFormat(u)+")"),e.write("</span>")}e.write("</div>")}},sapui6.ui.ux3.TeamCalendar.prototype.renderTaskSVG=function(e){var t=[],i=e.length,a=Math.floor((this._itemHeight-2)/i);t.push("<svg width='"+(this._itemWidth-2)+"' height='"+(this._itemHeight-2)+"'>");for(var r=0;i>r;r++){var l=this.getCategoryColor(e[r].getValue());t.push("<rect x='0' y='"+r*a+"' width='"+(this._itemWidth-2)+"' height='"+a+"' fill='"+l+"'></rect>")}return t.push("</svg>"),t.join("")},sapui6.ui.ux3.TeamCalendar.prototype._convertDateFormat=function(e){var t=this.getDateFormat(),i=t;return t&&8==e.length&&(i=i.replace("yyyy",e.substring(0,4)),i=i.replace("MM",e.substring(4,6)),i=i.replace("dd",e.substring(6,8))),i},sapui6.ui.ux3.TeamCalendar.prototype.getCategoryColor=function(e){var t=this.getCategory();if(t&&t.length>0)for(var i=t.length,a=0;i>a;a++)if(t[a].getValue()==e)return t[a].getColor();return""},sapui6.ui.ux3.TeamCalendar.prototype.doScroll=function(){$("#"+this.getId()+"-header-right").scrollLeft($("#"+this.getId()+"-body-right").scrollLeft()),$("#"+this.getId()+"-body-left").scrollTop($("#"+this.getId()+"-body-right").scrollTop())},sapui6.ui.ux3.TeamCalendar.prototype.getScrollBarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="100%";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="100px",t.style.height="100px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth,a=e.offsetHeight;t.style.overflow="scroll";var r=e.offsetWidth,l=e.offsetHeight;return i==r&&(r=t.clientWidth),a==l&&(l=t.clientHeight),document.body.removeChild(t),i-r},sapui6.ui.ux3.TeamCalendar.prototype._calculateGroupSize=function(){this._groupSize={};for(var e={},t=this.getItems(),i=t.length,a=0;i>a;a++)void 0==e[t[a].getKey()]&&(void 0==this._groupSize[t[a].getGroupKey()]?this._groupSize[t[a].getGroupKey()]=1:this._groupSize[t[a].getGroupKey()]=this._groupSize[t[a].getGroupKey()]+1,e[t[a].getKey()]=!0)},sapui6.ui.ux3.TeamCalendar.prototype._getHoliday=function(e){if(null==this._holiday){this._holiday={};for(var t=this.getHoliday(),i=t.length,a=0;i>a;a++)this._holiday[t[a].getDate()]=t[a]}return this._holiday[e]},sapui6.ui.ux3.TeamCalendar.prototype._handleResize=function(){if($("#"+this.getId()+"-right").css("width",$("#"+this.getId()).width()-$("#"+this.getId()+"-left").width()+"px"),this.getBodyHeight()){var e=this.getScrollBarWidth(),t=parseInt(this.getBodyHeight().split("px")[0]),i=this._memberCnt*this._itemHeight,a=this._end_of_month*this._itemWidth;i>t&&$("#"+this.getId()+"-body-right").css("height",t+e+"px"),a>$("#"+this.getId()+"-body-right").width()&&$("#"+this.getId()+"-header-right").css("width",$("#"+this.getId()+"-body-right").width()-e+"px")}},sap.ui.core.Element.extend("sapui6.ui.ux3.TeamCalendarItem",{metadata:{library:"sapui6.ui.ux3",properties:{key:{type:"string",defaultValue:null},title:{type:"string",defaultValue:null},date:{type:"string",defaultValue:null},value:{type:"string",defaultValue:null},groupKey:{type:"string",defaultValue:null},groupTitle:{type:"string",defaultValue:null}}}}),sap.ui.core.Element.extend("sapui6.ui.ux3.TeamCalendarCategory",{metadata:{library:"sapui6.ui.ux3",properties:{title:{type:"string",defaultValue:null},color:{type:"string",defaultValue:null},value:{type:"string",defaultValue:null}}}}),sap.ui.core.Element.extend("sapui6.ui.ux3.TeamCalendarHoliday",{metadata:{library:"sapui6.ui.ux3",properties:{title:{type:"string",defaultValue:null},date:{type:"string",defaultValue:null},color:{type:"string",defaultValue:"#cecece"}}}});